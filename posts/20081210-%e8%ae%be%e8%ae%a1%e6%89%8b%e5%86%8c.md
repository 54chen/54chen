title: 设计手册
link: http://www.54chen.com/life/%e8%ae%be%e8%ae%a1%e6%89%8b%e5%86%8c.html
author: cc0cc
description: 
post_id: 239
created: 2008/12/10 10:19:44
created_gmt: 2008/12/10 02:19:44
comment_status: open
post_name: %e8%ae%be%e8%ae%a1%e6%89%8b%e5%86%8c
status: private
post_type: post

# 设计手册

## [[编辑](http://10.62.164.49/wiki/index.php?title=%E8%AE%BE%E8%AE%A1%E6%89%8B%E5%86%8C&action=edit&section=1)] 摘要

本文介绍了一种基于 PostgreSQL 的关系型数据库集群的设计概要和简介。其中包括选型分析、基本结构、存储结构、索引结构、索引算法等描述。阐述了从框架到逻辑结构以及具体实现的软件组件。 

## [[编辑](http://10.62.164.49/wiki/index.php?title=%E8%AE%BE%E8%AE%A1%E6%89%8B%E5%86%8C&action=edit&section=2)] 需求

现代大型C/S应用大多基于数据库，而面对日益增长的用户数和数据量，基本上所有大型互联网应用都对数据库的容量和处理能力提出了更为苛刻的需求。解决这个问题的手段主要有两个：一个是中心式的高层次硬件，另外一个就是基于集群技术的数据库集群。两种模式各有自己的适用范围。就互联网应用而言，采用数据库集群的方式可以从成本、扩展、性能和易用性方面得到比较大的均衡，因此，我们选择了关系型数据库的集群做为业务的底层平台进行研发。 

## [[编辑](http://10.62.164.49/wiki/index.php?title=%E8%AE%BE%E8%AE%A1%E6%89%8B%E5%86%8C&action=edit&section=3)] 为何选用 PostgreSQL

选择 PostgreSQL 的原因： 

  1. 开放：PostgreSQL是开源软件
  2. 成本：纯自由软件，能挑战的只有自己的能力，永无费用之虞
  3. 成熟：PostgreSQL有十五年历史
  4. 扩展：PostgreSQL的扩展性举世闻名
  5. 自由：PostgreSQL的BSD版权和全球开放的开发队伍是自由且稳定的
  6. 可控：Laser 有 12 年的经验，并且4E已经有接近三年的应用历史
  7. 完整：拥有所有RDBMS特性和所有需要的基础搜索模块
  8. 简单：简单就是美，用通用的SQL做接口是应用开发的美好愿望，也是实现快速的根本
  9. 全面：支持RDF的DB（MIT RDF项目）
  10. 概念：PostgreSQL带给使用者普适的原理、概念，而不会用太多的封装愚弄用户，这点对于创业何其重要
  11. 兼容：与 Oracle 的相似程度超过 80%，移植方便
  12. 行列互换：支持面向列（化行为列）的数据库扩展
对于开发人员来说，选择一个开放平台的因素有如下几条： 
  1. 有良好背景以保证稳定
  2. 有活跃的团队以保持支持
  3. 有良好的接口以便扩展
  4. 有良好的代码和文档以便理解
  5. 有良好的客户接口以便适应灵活多变的快速应用开发
  6. 有完全合理的版权协议因而可以实现自主的知产
  7. 有足够的通用性以支持不同的产品
PostgreSQL 在上面所有的因素都满足得很好，尤其是扩展接口，是可获得的自由软件中是最为强大的。在这个强大的扩展接口的支持下，我们很容易地完成了诸如中文分词的集成、内存聚集和分类等项工作。从开始理解到完成任务的总开销只是两个人月，其扩展性可见一斑；同时，PostgreSQL的BSD版权让我们可以在扩展的同时，自行选择是否开放出去，而不用担心法律问题，因此，PostgreSQL也是一种“不可能被收购”的数据库，因为它是一个开源项目，而不是一个开源的公司。 

## [[编辑](http://10.62.164.49/wiki/index.php?title=%E8%AE%BE%E8%AE%A1%E6%89%8B%E5%86%8C&action=edit&section=4)] 设计目标 

  1. 结构单元化
  2. 功能通用化
  3. 成本可控化
  4. 搜索自主化
  5. 应用灵活化
  6. 信息总线化
其中几个细节要点是： 
  * 线性的存储扩展
  * 透明的访问界面
  * 支持应用分布
  * 支持结构化(半结构化)的数据存储
  * 系统的可进化性

## [[编辑](http://10.62.164.49/wiki/index.php?title=%E8%AE%BE%E8%AE%A1%E6%89%8B%E5%86%8C&action=edit&section=5)] 技术构成

![技术构成](http://10.62.164.49/wiki/images/thumb/0/03/Tech_point.png/400px-Tech_point.png)

![](http://10.62.164.49/wiki/skins/common/images/magnify-clip.png)

技术构成

构成图见右图。在一段合理的时间内，主要的技术构成有： 

  * 基于Firefox 的爬虫，以对付日益增长的纯客户端的网站
  * 基于格式化的数据feed，以增强合做伙伴的合做
  * 基于4GL/SQL的接口，以实现灵活的应用定制
  * 基于 Dom Tree 的抽取，以精确定位查找范围
  * 全文索引（倒排索引）
  * 哈希数据存储
  * 经典的基础 ranking 系统
  * 基于R/plR语言的数据统计分布计算与概率分析
  * 基于MLR（机器学习）和点击反馈（CTR）等的用户干预的ranking
  * 基于RDBMS集群的数据库关系处理
  * 基于分布文件系统的大对象（大附件）的存储与处理

## [[编辑](http://10.62.164.49/wiki/index.php?title=%E8%AE%BE%E8%AE%A1%E6%89%8B%E5%86%8C&action=edit&section=6)] 集群的逻辑结构

![集群的逻辑结构](http://10.62.164.49/wiki/images/thumb/2/22/PgCluster_logic_arch.png/400px-PgCluster_logic_arch.png)

![](http://10.62.164.49/wiki/skins/common/images/magnify-clip.png)

集群的逻辑结构

几个概念： 

  * 集群利用组通讯软件构造成一个信息总线（BUS），或者说主神经系统
  * 每个工作节点构成一个单元细胞（Cell）
  * 所有单元细胞（Cell）都通过总线连接在一起
  * 每个单元细胞（Cell）有自己的内部结构，由一到多台计算机不等的组成，具体的数目取决于细胞的角色
  * 整个集群由不同的单元细胞组成，目前主要的单元细胞角色是： 
    * proxy 角色的单元细胞
    * 承载数据和检索、运算行为的单元细胞